<link rel="import" href="../paper-filter/paper-filter.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<!--
`<open-elements>` 
@demo demo.html
-->

<dom-module id="open-elements">
  <template>
    <iron-ajax auto url="/list-of-elements" handle-as="text" last-response="{{list}}"></iron-ajax>
    <paper-filter show-numbers="true" min="2" data="{{data}}" by="group" output="{{output}}"></paper-filter>
    <select value="{{docsFor::input}}">
      <option value="false">show documentation</option>
      <template is="dom-repeat" items="{{output}}" >
        <option>{{item.name}}</option>
      </template>
    </select>
    <template is="dom-if" if="{{docsFor}}" >
      <iframe sandbox="allow-scripts allow-same-origin" height="500" style="margin:0; width:100%; border:none;" src="{{_docsSrc(docsFor,list)}}"></iframe>
    </template>
  </template>
</dom-module>
<script>
  Polymer({
    is: "open-elements",
    properties: {
      data: {computed:'getData(list)'},
    },
    getData: function(list) {
      var output = []
      var elements = list.split('\n')
      for (var i = 0; i < elements.length; ++i) {
        var path = elements[i].split('/')
        var file = path.pop()
        var folder =  path.pop()
        if (file.indexOf("-") !== -1 && file === folder + ".html" ) {
          output.push({group:file.slice(0, file.indexOf("-")), name: file.replace(".html","")})
        }
      }
      return output
    },
    _docsSrc: function (docsFor, listOfElements) {
      return 'data:text/html;charset=utf-8,' + encodeURIComponent(
        '<base href="https://open-elements.org/bower_components/' + docsFor + '/">\n' +
        '<link rel="import" href="../iron-component-page/iron-component-page.html">\n' +
        '<iron-component-page base="https://open-elements.org/bower_components/' + docsFor + '/" src="' + getfile(docsFor, listOfElements) + '"></iron-component-page>'
      )
    }
  }
  var getfile = function (dependency, listOfElements) {
    var re = /bower_components/gi
    var elements = listOfElements.split('\n')
    for (var i = 0; i < elements.length; ++i) {
      if (elements[i].indexOf('/' + dependency + '.html') !== -1) {
        return listOfElements.split('\n')[i].replace(re, '..')
      }
    }
    return false
  }
</script>

<link rel="import" href="../paper-filter/paper-filter.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<!--
`<open-elements>` 
@demo demo.html
-->

<dom-module id="open-elements">
  <template>
    <iron-ajax auto url="/list-of-elements" handle-as="text" last-response="{{list}}"></iron-ajax>
    <iron-ajax auto url="/tests" handle-as="text" last-response="{{tests}}"></iron-ajax>
    
    <paper-filter show-numbers="true" min="2" data="{{data}}" by="group" output="{{output}}"></paper-filter>
    <template is="dom-repeat" items="{{output}}" >
      {{item.name}} <a href="{{item.folder}}">docs</a> 
      <template is="dom-if" if="{{hasTest(item.name, tests)}}">
        <a href="{{item.test}}">test</a><a href=""
      </template>
      <br /> 
    </template>
    <p>
      <a href="https://open-elements.org/bower_components/polymer/" >Polymer Docs</a>
    </p>
    <a href="https://github.com/marcus7777/open-elements/edit/master/open-elements.html" >Fork me I'm yours</a>
  </template>
</dom-module>
<script>
  Polymer({
    is: "open-elements",
    properties: {
      data: {computed:'getData(list)'},
    },
    getData: function(list) {
      var output = []
      var elements = list.split('\n')
      for (var i = 0; i < elements.length; ++i) {
        var path = elements[i].split('/')
        var file = path.pop()
        var folder = path.pop()
        if (file.indexOf("-") !== -1 && file === folder + ".html" ) {
          output.push({
            group:file.slice(0, file.indexOf("-")), 
            name: folder,
            folder: '/'+path+'/'+folder,
            test: '/'+path+'/'+folder+'/test/',
            file: 'view-source:https://open-elements.org/'+path+'/'+folder+'/'+file
          })
        }
      }
      return output
    },
    hasTest: function(path, tests) {
      return -1 !== tests.indexOf(path)
    }
  })
</script>
